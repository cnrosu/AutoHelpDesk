# Redundant collector command usage

Several collectors invoke the same expensive CIM queries independently. Capturing these once and
sharing the results (either by caching inside `CollectorCommon.ps1` or by letting downstream
collectors consume the JSON generated by `Collect-System.ps1`) would reduce runtime and improve
consistency.

`CollectorCommon.ps1` now exposes memoized helpers (`Get-CollectorOperatingSystem`,
`Get-CollectorComputerSystem`, and `Get-CollectorServiceInventory`/`Get-CollectorServiceByName`) so
callers can reuse the same CIM snapshot within a collection run. Future collectors should favor
these helpers instead of invoking CIM queries directly unless a fresh snapshot is required.

## Win32_OperatingSystem queries

* `Collectors/System/Collect-System.ps1` gathers OS metadata via `Get-CimInstance -ClassName Win32_OperatingSystem`.
* `Collectors/System/Collect-Performance.ps1` re-runs the same query to fetch memory statistics.
* `Collectors/System/Collect-Uptime.ps1` repeats the call for uptime calculations.
* `Collectors/Network/Collect-VpnBaseline.ps1` fetches the OS build with the same CIM command.

Memoized helper: use `Get-CollectorOperatingSystem` to reuse the cached OS object instead of
invoking CIM directly.

## Win32_ComputerSystem queries

* `Collectors/System/Collect-System.ps1` collects chassis/domain metadata with `Get-CimInstance -ClassName Win32_ComputerSystem`.
* `Collectors/Security/Collect-FirmwareSecurity.ps1` repeats the computer system query for security payloads.
* `Collectors/Office/Collect-AutodiscoverDiagnostics.ps1` reuses the same CIM class to detect domain membership.
* `Collectors/Active Directory/Collect-ADHealth.ps1` again reads `Win32_ComputerSystem` to determine domain join status.

Memoized helper: use `Get-CollectorComputerSystem` to reuse the cached computer system object or to
propagate the error metadata generated by the shared helper.

## Service inventory queries

* `Collectors/System/Collect-Services.ps1` enumerates every service via `Get-CimInstance -ClassName Win32_Service`.
* `Collectors/Services/Collect-ServiceBaseline.ps1` performs the same full enumeration (with WMI and `Get-Service` fallbacks).
* `Collectors/Services/Collect-Printing.ps1` queries the spooler service through the same CIM class before falling back to WMI/`Get-Service`.
* `Collectors/Network/Collect-VpnBaseline.ps1` hits `Win32_Service` for RasMan/RasAuto metadata.
* `Collectors/System/Collect-MicrosoftStoreFunctional.ps1` queries `Win32_Service` again for specific dependencies.

Memoized helper: use `Get-CollectorServiceInventory` for the global snapshot and
`Get-CollectorServiceByName` when only a single service is required; both functions honor CIM/WMI
fallbacks and record retrieval warnings for verbose logging.
