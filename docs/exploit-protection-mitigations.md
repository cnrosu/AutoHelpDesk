## Summary
AutoHelpDesk reviews the system-wide exploit protection settings for Control Flow Guard (CFG), Data Execution Prevention (DEP), and mandatory ASLR to assess memory-hardening posture. Missing mitigations trigger a medium-severity card because common exploits become easier to weaponize. This section explains the required evidence and how the heuristic evaluates each flag.

## Signals to Collect
- `Get-ProcessMitigation -System | Select-Object -ExpandProperty System` → Review CFG, DEP, and ASLR state values.
- `Get-ProcessMitigation -RegistryConfigFilePath "$env:USERPROFILE\Desktop\ExploitConfig.xml"` → Export the active policy for audit or redeployment.
- `Get-WinEvent -LogName 'Microsoft-Windows-Windows Defender/Operational' -MaxEvents 50 | Where-Object { $_.Id -eq 1123 }` → Check for recent exploit protection policy application events.

## Detection Rule
- Parse the exploit protection payload and normalize `CFG.Enable`, `DEP.Enable`, and `ASLR.Enable` values.
- Raise a **medium-severity** card when any mitigation reports `0` (disabled) or `$null` (unknown).
- Emit a **normal** card when all three mitigations equal `1`, including evidence listing each field.
- Surface an **unknown** card when the collector fails, embedding the error text from the payload.

## Heuristic Mapping
- `Security.DeviceProtection`

## Remediation
1. Enable exploit protection system settings via Windows Security (**App & browser control → Exploit protection → System settings**) or deploy a `Set-ProcessMitigation -System` script with CFG, DEP AlwaysOn, and ASLR ForceRelocateImages.
2. Confirm the policy persisted by exporting the configuration or reviewing the Windows Defender Operational log for policy application events.
3. Reboot or sign out/in so the mitigations apply to running processes.
4. Re-run AutoHelpDesk collectors to validate all mitigation flags return `1`.

## References
- `docs/exploit-protection-mitigations.md`

# Exploit protection mitigation heuristic

The security analyzer reads the system-wide process mitigation policy from the
`exploit-protection` artifact, which is collected by running
`Get-ProcessMitigation -System`. The payload exposes whether Control Flow Guard
(CFG), Data Execution Prevention (DEP), and mandatory Address Space Layout
Randomization (ASLR) are enabled across the device.

The "Exploit protection mitigations not fully enabled" issue is raised with
medium severity whenever any of these global mitigations is reported as disabled
or left unset. The evidence section lists each field (`CFG.Enable`,
`DEP.Enable`, `ASLR.Enable`) so technicians can see which settings returned `0`
(disabled), `1` (enabled), or `$null` (unknown). When all three mitigations
return `1`, the analyzer instead records a normal stating that exploit
protection is enforced.

If the card appears with all three values at `0`, it means the device is running
without CFG, DEP, or ASLR hardening. That configuration leaves memory-corruption
exploits significantly easier to weaponize because common defenses against
code-reuse or malicious payload injection are absent.

To remediate the warning, enable exploit protection system settings through the
Windows Security app (App & browser control → Exploit protection → System
settings) or deploy a `Set-ProcessMitigation -System` policy that turns on CFG,
DEP (AlwaysOn), and ASLR (ForceRelocateImages). After applying the policy, reboot
or log off affected devices so the mitigations take effect.
